#!/usr/bin/env Rscript
#
# Generates statistical analysis for RQ2 with p-value, Cohen's d, R^2.
# Input:
# - 1. The `decomposition_scores.csv` file generated by `decompose.sh`.
# - 2. The `metrics.csv` file generated by `get_metrics.sh`.
# Output: The path to the file where the results will be saved.

library(tidyverse)
library(car)
library(rstatix)
library(ggpubr)
library(lme4)
library(effsize)
library(lmerTest)

if (length(args)!=3) {
  stop("Please provide the input files and output path.", call.=FALSE)
}
decompositionScoresPath = args[1]
metricsPath = args[2]
outputPath = args[3]

# Merge the decomposition scores and metrics files. See Jupyter notebook `analysis.ipynb` for details.
# mergedData = ....
mergedData <- na.omit(mergedData)

# Convert to long format
data_long = pivot_longer(data, cols = c(smartcommit_rand_index, flexeme_rand_index), names_to = 'Tool', values_to = 'Performance')

model <- lmer(Performance ~ Tool + files_updated + test_files_updated + hunks + average_hunk_size + lines_updated, data=data_long)

# p-value, R^2
summary(model)

# Cohen's d for statistically significant metrics
cohen.d(data_long$average_hunk_size, data_long$Performance)
cohen.d(data_long$lines_updated, data_long$Performance)
