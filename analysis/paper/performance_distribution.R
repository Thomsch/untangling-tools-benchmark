#!/usr/bin/env Rscript
#
# Generates the performance distribution plot for the paper in RQ1.
# Input: The `decomposition_scores.csv` file generated by `decompose.sh`.
# Output: The path to the output PDF file.

library(tidyverse)
library(flexplot)

args = commandArgs(trailingOnly=TRUE)

if (length(args)!=2) {
  stop("Please provide an input file and output file.n", call.=FALSE)
}
inputFile = args[1]
outputFile = args[2]


data <- read.csv(inputFile, header = FALSE, col.names = c('Project', 'CommitId', 'SmartCommit', 'Flexeme', 'File-based'))
data$Commit <- as_factor(data$Commit)

# Convert to long format
data_long = pivot_longer(data, cols = c("Flexeme", "SmartCommit", "File-based"), names_to = 'Tool', values_to = 'Performance')
data_long$Tool <- factor(data_long$Tool, levels = c("Flexeme", "SmartCommit", "File-based"))

pdf(outputFile)
flexplot(Performance ~ Tool, data = data_long) + scale_x_discrete(limits = c("Flexeme", "SmartCommit", "File-based"))
dev.off()